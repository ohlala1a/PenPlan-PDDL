(define (domain pentest-root)
  (:requirements :strips :typing :conditional-effects)

  (:types
    asset tool credential data - object
    network-asset system-asset service-asset - asset
    attack-tool defense-tool - tool
    vulnerability protocol os-type patch-level privesc-type - object
    version config-type action segment vlan rule port software - object
  )

  (:predicates
    ;; Core connectivity predicates
    (connected ?from ?to - asset)
    (allowed ?proto - protocol ?from ?to - asset)
    (isolated ?asset - asset)

    ;; System properties
    (os ?system - system-asset ?type - os-type)
    (patch-level ?system - system-asset ?level - patch-level)
    (privesc-primitive ?system - system-asset ?primitive - privesc-type)
    (admin-access ?system - system-asset)
    (user-access ?system - system-asset)

    ;; Service properties
    (service-version ?service - service-asset ?version - version)
    (has-vuln ?service - service-asset ?cve - vulnerability)
    (config ?service - service-asset ?setting - config-type)
    (service-running ?service - service-asset)

    ;; Detection and evasion
    (detected ?activity - action ?defense - defense-tool)
    (evaded ?activity - action ?defense - defense-tool)

    ;; Objectives
    (exfiltrated ?data - data)
    (persisted ?system - system-asset)
    (disabled ?defense - defense-tool)
    (discovered ?asset - asset)

    ;; Network topology and access control
    (network-segment ?asset - asset ?segment - segment)
    (firewall-rule ?rule - rule ?from ?to - segment)
    (vlan-isolation ?vlan1 ?vlan2 - vlan)
    (routing-table ?router - asset ?dest - segment ?next-hop - asset)
  )

  ;; Network actions
  (:action network-scan
    :parameters (?attacker - asset ?target - network-asset ?tool - attack-tool)
    :precondition (and (connected ?attacker ?target)
                       (not (isolated ?target)))
    :effect (discovered ?target)
  )

  (:action exploit-public-facing-app
    :parameters (?attacker - asset ?target - service-asset ?vuln - vulnerability)
    :precondition (and (connected ?attacker ?target)
                       (has-vuln ?target ?vuln)
                       (service-running ?target))
    :effect (user-access ?target)
  )

  ;; Service exploitation actions
  (:action exploit-cve-2021-41773
    :parameters (?attacker - asset ?target - service-asset ?apache-vuln - vulnerability)
    :precondition (and (service-running ?target)
                       (has-vuln ?target ?apache-vuln))
    :effect (user-access ?target)
  )

  (:action use-valid-accounts
    :parameters (?attacker - asset ?target - asset ?creds - credential)
    :precondition (discovered ?creds)
    :effect (user-access ?target)
  )

  ;; System actions
  (:action wmi-execution
    :parameters (?attacker - asset ?target - system-asset)
    :precondition (user-access ?target)
    :effect (admin-access ?target)
  )

  (:action create-scheduled-task
    :parameters (?attacker - asset ?target - system-asset)
    :precondition (admin-access ?target)
    :effect (persisted ?target)
  )

  ;; Data exfiltration
  (:action exfiltrate-data
    :parameters (?attacker - asset ?target - data ?system - asset)
    :precondition (and (user-access ?system)
                       (discovered ?target))
    :effect (exfiltrated ?target)
  )

  ;; Simple discovery action
  (:action discover-data
    :parameters (?attacker - asset ?target - data ?system - asset)
    :precondition (user-access ?system)
    :effect (discovered ?target)
  )
)
(define (domain pentest-root)
  (:requirements :strips :typing :negative-preconditions)

  (:types
    asset tool credential data - object
    network-asset system-asset service-asset - asset
    attack-tool defense-tool - tool
    vulnerability - object
  )

  (:predicates
    ;; Core connectivity
    (connected ?from ?to - asset)
    (isolated ?asset - asset)

    ;; Access levels
    (user-access ?sys - system-asset)
    (admin-access ?sys - system-asset)

    ;; Service properties
    (service-running ?svc - service-asset)
    (has-vuln ?svc - service-asset ?vuln - vulnerability)

    ;; Discovery and objectives
    (discovered ?asset - asset)
    (scanned ?asset - asset)
    (exploited ?asset - asset)

    ;; Data operations
    (data-on ?d - data ?sys - system-asset)
    (collected ?d - data)
    (exfiltrated ?d - data)

    ;; Persistence
    (persisted ?sys - system-asset)

    ;; Defense
    (defense-active ?def - defense-tool ?sys - system-asset)
    (evaded ?def - defense-tool)
  )

  ;; Reconnaissance
  (:action scan-network
    :parameters (?attacker - asset ?target - network-asset)
    :precondition (and
      (connected ?attacker ?target)
      (not (isolated ?target))
    )
    :effect (and
      (scanned ?target)
      (discovered ?target)
    )
  )

  (:action discover-system
    :parameters (?net - network-asset ?sys - system-asset)
    :precondition (and
      (scanned ?net)
      (connected ?net ?sys)
      (not (isolated ?sys))
    )
    :effect (discovered ?sys)
  )

  ;; Exploitation
  (:action exploit-service
    :parameters (?sys - system-asset ?svc - service-asset ?vuln - vulnerability)
    :precondition (and
      (discovered ?sys)
      (connected ?sys ?svc)
      (service-running ?svc)
      (has-vuln ?svc ?vuln)
      (not (isolated ?svc))
    )
    :effect (and
      (exploited ?svc)
      (user-access ?sys)
    )
  )

  (:action escalate-privileges
    :parameters (?sys - system-asset)
    :precondition (user-access ?sys)
    :effect (and
      (admin-access ?sys)
      (not (user-access ?sys))
    )
  )

  ;; Persistence
  (:action establish-persistence
    :parameters (?sys - system-asset)
    :precondition (admin-access ?sys)
    :effect (persisted ?sys)
  )

  ;; Data operations
  (:action locate-data
    :parameters (?sys - system-asset ?d - data)
    :precondition (and
      (user-access ?sys)
      (data-on ?d ?sys)
    )
    :effect (discovered ?d)
  )

  (:action collect-data
    :parameters (?sys - system-asset ?d - data)
    :precondition (and
      (user-access ?sys)
      (discovered ?d)
      (data-on ?d ?sys)
    )
    :effect (collected ?d)
  )

  (:action exfiltrate-data
    :parameters (?sys - system-asset ?d - data)
    :precondition (and
      (user-access ?sys)
      (collected ?d)
    )
    :effect (exfiltrated ?d)
  )

  ;; Defense evasion
  (:action evade-defense
    :parameters (?sys - system-asset ?def - defense-tool)
    :precondition (and
      (admin-access ?sys)
      (defense-active ?def ?sys)
    )
    :effect (evaded ?def)
  )
)
